<head>
  <title>Install Zabbix Server 4.2</title>
  <link rel="shortcut icon" href="./CentOS_Logo.png" type="image/png">
</head>
 <head>
  <meta charset="utf-8">
 </head>
<style>
.neonText1 {
  color: #87CEFA;
  text-shadow:
      0 0 1px #4169E1,
      0 0 1px #4169E1,
      0 0 1px #4169E1,
      0 0 1px #4169E1,
      0 0 1px #4169E1,
      0 0 1px #4169E1,
      0 0 1px #4169E1,
      0 0 1px #4169E1;
}
.neonText2 {
  color: #00FF00;
  text-shadow:
      0 0 1px #006400,
      0 0 1px #006400,
      0 0 1px #006400,
      0 0 1px #006400,
      0 0 1px #006400,
      0 0 1px #006400,
      0 0 1px #006400,
      0 0 1px #006400;
}
/* Additional styling */
body{
    background-color: black;
    background-repeat: no-repeat;
    background-size: cover;
    background-attachment: fixed;
    max-width: 1400px;
    margin: 0 auto;
    padding: 20px;
    color: #cfcfcf;
}
a {
    text-decoration: none;
}
p {
  text-indent: 1.5em;
  font-family: monospace;
  font-weight: 500;
  white-space: pre;
  line-height: 2;
  letter-spacing: 1px;
}
</style>
<div class="container">
<p class="neonText1">
Развертывание сервера с свободной системой мониторинга статусов разнообразных сервисов компьютерной сети, серверов и сетевого оборудования Zabbix на ОС Linux CentOS 7
--------------------------------------------------------------------------------------------------------------------------------------------------------------
Все описанные ниже действия выполнялись под пользователем root
--------------------------------------------------------------------------------------------------------------------------------------------------------------
Всем привет! Для реализации данного проекта мне потребовалось:
1) Прописать статические IP-адреса;
2) Обновить пакеты ОС Linux CentOS 7 до последней версии;
3) Отключить систему принудительного контроля доступа SELinux;
4) Установить дополнительный Epel-репозиторий;
5) Установить репозиторий Zabbix Server 4.2;
6) Установить пакеты Zabbix Server-а;
7) Установить и запустить сервис синхронизации времени;
8) Настроить брандмауэр;
9) Установить и настроить БД;
10) Установить и настроить Web-сервер Nginx;
11) Установить и настроить PHP. Установить дополнительные компоненты для PHP. Установить Nano;
12) Настроить совместнуб работу Nginx и PHP;
13) Создать и настроить БД;
14) Настроить конфигурационный файл Zabbix;
15) Запустить Zabbix Server;
16) Настроить Nginx;
17) Настроить Zabbix через Zabbix Web.
--------------------------------------------------------------------------------------------------------------------------------------------------------------
Предисловие:
------------
Nano — это консольный текстовый редактор для UNIX и Unix-подобных операционных систем, основанный на библиотеке curses и распространяемый под лицензией GNU GPL.
------------
SELinux — реализация системы принудительного контроля доступа, которая может работать параллельно с классической избирательной системой контроля доступа.
------------
EPEL (Extra Packages for Enterprise Linux) ― это открытое бесплатное хранилище пакетов от Fedora. Оно содержит пакеты дополнительного программного обеспечения
для Linux. Пакеты этого репозитория не конфликтуют с пакетами RHEL, поэтому этот репозиторий самый безопасный в использовании для CentOS.
------------
NMTUI — это инструмент командной строки, который используется для настройки сети в системах Gnu / Linux. При запуске он вызывает графический текстовый 
интерфейс, который помогает пользователям легко и эффективно настраивать сетевые интерфейсы.
------------
Zabbix — это свободная система мониторинга статусов разнообразных сервисов компьютерной сети, серверов и сетевого оборудования.
--------------------------------------------------------------------------------------------------------------------------------------------------------------
1) Для избежания потери связи с АРМ/VM, нужно позаботиться о статической IP-адресации. Её можно настроить как на самой АРМ/VM, так и на самом сетевом 
устройстве. Статическую адресацию можно прописать с помощью инструмента командной строки nmtui.
------------
<a class="neonText2">yum install -y NetworkManager-tui</a> |#|#| Установка пакета "nmtui" для настройки сети на АРМ/VM
------------
Гайд по тому, как пользоваться инструментом nmtui, вы можете посмотреть в интернете.
--------------------------------------------------------------------------------------------------------------------------------------------------------------
2) Обновление пакетов системы.
------------
<a class="neonText2">yum update -y && yum upgrade -y</a> |#|#| Поиск и обновление пакетов системы
------------
<a class="neonText2">reboot</a> |#|#| Команда для перезагрузки АРМ/VM
--------------------------------------------------------------------------------------------------------------------------------------------------------------
3) Отключение системы принудительного контроля доступа SELinux.
------------
<a class="neonText2">setenforce 0</a> |#|#| Команда для отключения SELinux в текущий момент
------------
<a class="neonText2">sed -i "s/SELINUX=enforcing/SELINUX=disabled/" /etc/selinux/config</a> |#|#| Команда для отключения SELinux на постоянную основу
--------------------------------------------------------------------------------------------------------------------------------------------------------------
4) Установка Epel-репозитория.
------------
<a class="neonText2">yum install -y epel-release</a> |#|#| Команда для подключения Epel-репозитория
--------------------------------------------------------------------------------------------------------------------------------------------------------------
5) Установка репозитория Zabbix Server 4.2.
------------
<a class="neonText2">yum install -y https://repo.zabbix.com/zabbix/4.2/rhel/7/x86_64/zabbix-release-4.2-2.el7.noarch.rpm</a> |#|#| Команда для подключения Zabbix-репозитория
--------------------------------------------------------------------------------------------------------------------------------------------------------------
6) Установка пакетов Zabbix Server-а.
------------
<a class="neonText2">yum install -y zabbix-server-mysql zabbix-web-mysql zabbix-agent zabbix-get</a> |#|#| Команда установки пакетов Zabbix Server-а
--------------------------------------------------------------------------------------------------------------------------------------------------------------
7) Установка и запуск сервиса синхронизации времени.
------------
<a class="neonText2">yum install -y chrony</a> |#|#| Команда для установка пакета Chrony
------------
<a class="neonText2">systemctl enable chronyd</a> |#|#| Команда для добавления службы Chrony в автозагрузку
------------
<a class="neonText2">systemctl start chronyd</a> |#|#| Команда для запуска службы Chrony
--------------------------------------------------------------------------------------------------------------------------------------------------------------
8) Настройка брандмауэра.
------------
<a class="neonText2">firewall-cmd --permanent --add-port={80/tcp,443/tcp,10051/tcp,10050/tcp,10050/udp,10051/udp}</a> |#|#| Команда для открытия tcp-портов: 80, 443, 10051, 10050 и udp-портов: 10050, 10051
------------
<a class="neonText2">firewall-cmd --reload</a> |#|#| Команда для перезапуска файрвола и применения всех изменений
--------------------------------------------------------------------------------------------------------------------------------------------------------------
9) Установка и настройка БД.
------------
<a class="neonText2">yum install -y mariadb mariadb-server</a> |#|#| Команда для установки пакетов "Mariadb" и "Mariadb-Server"
------------
<a class="neonText2">systemctl enable mariadb</a> |#|#| Команда для добавления службы Mariadb в автозагрузку
------------
<a class="neonText2">systemctl start mariadb<>/a |#|#| Команда для запуска службы Mariadb
------------
<a class="neonText2">mysqladmin -u root password</a> |#|#| Команда для создания пароля для суперпользователя СУБД
--------------------------------------------------------------------------------------------------------------------------------------------------------------
10) Установка и настройка Web-сервера Nginx.
------------
<a class="neonText2">yum install nginx</a> |#|#| Команда для установки пакета Nginx
------------
<a class="neonText2">systemctl enable nginx</a> |#|#| Команда для добавления службы Nginx в автозагрузку
------------
<a class="neonText2">systemctl start nginx</a> |#|#| Команда для запуска службы Nginx
--------------------------------------------------------------------------------------------------------------------------------------------------------------
11) Установка и настройка PHP. Установка дополнительных компонентов для PHP. Установка Nano.
------------
<a class="neonText2">yum install -y php php-fpm php-mysql php-pear php-cgi php-common php-ldap php-mbstring php-snmp php-gd php-xml php-gettext php-bcmath</a> |#|#| Команда для установки пакета "PHP" и дополнительных пакетов для корректной работы "PHP"
------------
<a class="neonText2">yum install -y nano</a> |#|#| Команда для установки пакета консольного текстового редактора Nano
------------
<a class="neonText2">nano /etc/php.ini</a> |#|#| Команда для открытия файла "php.ini" в текстовом редакторе Nano
------------
Приведите прописанные ниже строки в файле "php.ini" к следующему виду:
<a class="neonText2">
date.timezone = "Asia/Yekaterinburg"
max_execution_time = 300
post_max_size = 16M
max_input_time = 300
max_input_vars = 10000</a>
------------
<a class="neonText2">systemctl enable php-fpm</a> |#|#| Команда для добавления службы "php-fpm" в автозагрузку
------------
<a class="neonText2">systemctl start php-fpm</a> |#|#| Команда для запуска службы "php-fpm"
--------------------------------------------------------------------------------------------------------------------------------------------------------------
12) Настройка совместной работы Nginx и PHP.
------------
<a class="neonText2">nano /etc/nginx/nginx.conf</a> |#|#| Команда для открытия файла nginx.conf в текстовом редакторе Nano
------------
Приведите раздел "server" в файле "nginx.conf" к следующему виду:
<a class="neonText2">
server {
        listen       80 default_server;
        server_name  _;
        set $root_path /usr/share/nginx/html;

        root $root_path;

        location / {
                index index.php;
        }

        location ~ \.php$ {
                fastcgi_pass 127.0.0.1:9000;
                fastcgi_buffer_size 32k;
                fastcgi_buffers 4 32k;
                fastcgi_index index.php;
                fastcgi_param SCRIPT_FILENAME $root_path$fastcgi_script_name;
                include fastcgi_params;
                fastcgi_param DOCUMENT_ROOT $root_path;
                fastcgi_read_timeout 300;
        }
}</a>
------------
<a class="neonText2">nginx -t</a> |#|#| Команда для проверки коррекности настроенной конфигурации Nginx
------------
<a class="neonText2">systemctl restart nginx</a> |#|#| Команда для перезапуска службы Nginx
------------
<a class="neonText2">cd /usr/share/nginx/html</a> |#|#| Команда для перехода в каталог "/usr/share/nginx/html"
------------
<a class="neonText2">nano index.php</a> |#|#| Команда для создания файла "index.php"
------------
Приведите текстовый файл "index.php" к следующему виду и не забудьте сохранить файл перед закрытием:
<a class="neonText2">
&lt;?php phpinfo(); ?&gt;</a>
--------------------------------------------------------------------------------------------------------------------------------------------------------------
13) Создание и настройка БД.
------------
<a class="neonText2">mysql -u root -p</a> |#|#| Команда для входа в реляционную систему управления БД(При входе вводите пароль от суперпользователя СУБД)
------------
<a class="neonText2">CREATE DATABASE zabbix DEFAULT CHARACTER SET utf8 DEFAULT COLLATE utf8_general_ci;</a> |#|#| Команда для создания БД "zabbix"
------------
<a class="neonText2">GRANT ALL PRIVILEGES ON zabbix.* TO zabbix@localhost IDENTIFIED BY 'zabbixpassword';</a> |#|#| Команда для создания пользователя "zabbix" с паролем "zabbixpassword"
------------
<a class="neonText2">\q</a> |#|#| Команда для выхода из реляционной системы управления БД
------------
<a class="neonText2">cd /usr/share/doc/zabbix-server-mysql-*</a> |#|#| Команда для перехода в каталог "/usr/share/doc/zabbix-server-mysql-*"
------------
<a class="neonText2">gunzip create.sql.gz</a> |#|#| Команда для распаковки архива с дампом базы
------------
<a class="neonText2">mysql -u root -p zabbix < create.sql</a> |#|#| Команда для восстановления БД(При восстановлении вводите пароль от суперпользователя СУБД)
--------------------------------------------------------------------------------------------------------------------------------------------------------------
14) Настройка конфигурационного файла Zabbix.
------------
<a class="neonText2">nano /etc/zabbix/zabbix_server.conf</a> |#|#| Команда для открытия файла "zabbix_server.conf" в текстовом редакторе Nano
------------
Приведите прописанные ниже строки в файле "zabbix_server.conf" к следующему виду(имя базы и пользователя должны быть "zabbix" т.к.они созданы в "mariadb"):
<a class="neonText2">
DBPassword=zabbixpassword
DBName=zabbix
DBUser=zabbix</a>
--------------------------------------------------------------------------------------------------------------------------------------------------------------
15) Запуск Zabbix Server.
------------
<a class="neonText2">systemctl enable zabbix-server</a> |#|#| Команда для добавления службы "zabbix-server" в автозагрузку
------------
<a class="neonText2">systemctl start zabbix-server</a> |#|#| Команда для запуска службы "zabbix-server"
--------------------------------------------------------------------------------------------------------------------------------------------------------------
16) Настройка Nginx.
------------
<a class="neonText2">nano /etc/nginx/nginx.conf</a> |#|#| Команда для открытия файла "nginx.conf" в текстовом редакторе Nano
------------
Приведите строку в текстовом файле "nginx.conf" к следующему виду и не забудьте сохранить файл перед закрытием:
<a class="neonText2">
set $root_path /usr/share/zabbix;</a>
------------
<a class="neonText2">systemctl restart nginx</a> |#|#| Команда для перезапуска службы "Nginx"
--------------------------------------------------------------------------------------------------------------------------------------------------------------
17) Настройка/установка Zabbix через Zabbix Web.
------------
1. Открываете браузер и переходите по адресу http://IP-address server-a/zabbix/ — откроется страница установки Zabbix Web и нажимаем на кнопку "Next Step"
2. Далее внимательно смотрим на результаты проверки нашего Web-сервера — справа мы должны увидеть все OK. Когда все результаты будут OK, нажимаем на "Next Step"
3. Далее настройки подключения к базе оставляем как есть — дополнительно прописываем пароль, который задали при создании пользователя zabbix (в нашем случае zabbixpassword). После нажимаем "Next Step"
4. Далее в окне оставляем все как есть и нажимаем "Next Step"
5. В последнем окне мы проверяем настройки и нажимаем "Next Step"
6. После завершения установки нажимаем на кнопку "Finish"
7. Для входа в систему используйте следующие учетные данные:

Login: Admin
Password: zabbix
--------------------------------------------------------------------------------------------------------------------------------------------------------------
На этом инструкция закончена! Спасибо за внимание!
</p>
</div>
