<head>
  <title>Observium</title>
  <link rel="shortcut icon" href="./CentOS_Logo.png" type="image/png">
</head>
 <head>
  <meta charset="utf-8">
 </head>
<style>
.neonText1 {
  color: #87CEFA;
  text-shadow:
      0 0 1px #4169E1,
      0 0 1px #4169E1,
      0 0 1px #4169E1,
      0 0 1px #4169E1,
      0 0 1px #4169E1,
      0 0 1px #4169E1,
      0 0 1px #4169E1,
      0 0 1px #4169E1;
}
.neonText2 {
  color: #00FF00;
  text-shadow:
      0 0 1px #006400,
      0 0 1px #006400,
      0 0 1px #006400,
      0 0 1px #006400,
      0 0 1px #006400,
      0 0 1px #006400,
      0 0 1px #006400,
      0 0 1px #006400;
}
/* Additional styling */
body{
    background-color: black;
    background-repeat: no-repeat;
    background-size: cover;
    background-attachment: fixed;
    max-width: 1400px;
    margin: 0 auto;
    padding: 20px;
    color: #cfcfcf;
}
a {
    text-decoration: none;
}
p {
  text-indent: 1.5em;
  font-family: monospace;
  font-weight: 500;
  white-space: pre;
  line-height: 2;
  letter-spacing: 1px;
}
</style>
<div class="container">
<p class="neonText1">
Развертывание сервера с системой мониторинга Observium на ОС Linux CentOS 7
--------------------------------------------------------------------------------------------------------------------------------------------------------------
Все описанные ниже действия выполнялись под пользователем root
--------------------------------------------------------------------------------------------------------------------------------------------------------------
Всем привет! Для реализации данного проекта мне потребовалось:
1) Прописать статические IP-адреса;
2) Обновить пакеты ОС Linux CentOS 7 до последней версии;
3) Отключить систему принудительного контроля доступа SELinux;
4) Подключить нужные для дальнейшей работы репозитории;
5) Установить необходимые пакеты для дальнейшей работы;
6) Настроить базу данных MySQL для ПО Observium;
7) Настроить и запустить ПО Observium с дальнейшей настройкой зависимостей;
8) Настроить Firewall;
9) Горячие комбинации.
--------------------------------------------------------------------------------------------------------------------------------------------------------------
Предисловие:
------------
SELinux — реализация системы принудительного контроля доступа, которая может работать параллельно с классической избирательной системой контроля 
------------
Remi - это хранилище yum-репозиториев. Хранилище Remi предоставляет разнообразные up-to-date пакеты, которые оченьполезны или являются необходимыми для многих 
популярных веб-сервисов.
------------
Cron — классический демон, использующийся для периодического выполнения заданий в определённое время. Регулярные действия описываются инструкциями, помещенными
в файлы crontab и в специальные каталоги.
------------
Observium – это система мониторинга и наблюдения за сетевыми устройствами и серверами.
--------------------------------------------------------------------------------------------------------------------------------------------------------------
1) Для избежания потери связи с АРМ/VM, нужно позаботиться о статической IP-адресации. Её можно настроить как на самой АРМ/VM, так и на самом сетевом 
устройстве. Статическую адресацию можно прописать с помощью инструмента командной строки nmtui.
------------
<a class="neonText2">yum install -y NetworkManager-tui</a> |#|#| Установка пакета nmtui для настройки сети на АРМ/VM
------------
Гайд по тому, как пользоваться инструментом nmtui, вы можете посмотреть в интернете.
--------------------------------------------------------------------------------------------------------------------------------------------------------------
2) Обновление пакетов системы.
------------
<a class="neonText2">yum update -y && yum upgrade -y</a> |#|#| Поиск и обновление пакетов системы
--------------------------------------------------------------------------------------------------------------------------------------------------------------
3) Отключение системы принудительного контроля доступа SELinux.
------------
<a class="neonText2">nano /etc/sysconfig/selinux</a> |#|#| Команда для открытия конфигурационного файла "selinux"
------------
В конфигурационном файле замените строку SELINUX=enforcing на SELINUX=disabled. Перед закрытием обязательно сохраните файл!
------------
Конфигурационный файл SELinux должен выглядеть следующим образом:
<a class="neonText2">
# This file controls the state of SELinux on the system.
# SELINUX= can take one of these three values:
#       enforcing - SELinux security policy is enforced.
#       permissive - SELinux prints warnings instead of enforcing.
#       disabled - No SELinux policy is loaded.
SELINUX=disabled
# SELINUXTYPE= can take one of these two values:
#       targeted - Targeted processes are protected,
#       mls - Multi Level Security protection.
SELINUXTYPE=targeted</a>
------------
<a class="neonText2">reboot</a> |#|#| Команда для перезагрузки ARM/VM
------------
После перезагрузки вашего устройства, можете снова ввести команду "sestatus" и убедиться в том, что у вас отключена система SELinux.
Вывод отключенной системы должен выглядеть вот так: 

SELinux status:                 disabled
--------------------------------------------------------------------------------------------------------------------------------------------------------------
4) Установка нужных для дальнейшей работы репозиториев.
------------
<a class="neonText2">yum install -y https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm</a> |#|#| Установка репозитория epel-release-latest-7.noarch.rpm
------------
<a class="neonText2">yum install -y http://yum.opennms.org/repofiles/opennms-repo-stable-rhel7.noarch.rpm</a> |#|#| Установка репозитория opennms-repo-stable-rhel7.noarch.rpm
------------
<a class="neonText2">yum install -y http://rpms.remirepo.net/enterprise/remi-release-7.rpm</a> |#|#| Установка репозитория remi-release-7.rpm
------------
<a class="neonText2">yum update -y</a> |#|#| Команда для обновления пакетов после установки репозиториев
--------------------------------------------------------------------------------------------------------------------------------------------------------------
5) Установка необходимых пакетов для дальнейшей работы.
------------
<a class="neonText2">yum install -y openssh wget.x86_64 httpd.x86_64 php.x86_64 php-opcache.x86_64 php-mysql.x86_64 php-gd.x86_64 php-posix php-pear.noarch cronie.x86_64 
net-snmp.x86_64 net-snmp-utils.x86_64 fping.x86_64 mariadb-server.x86_64 mariadb.x86_64 MySQL-python.x86_64 rrdtool.x86_64 subversion.x86_64  jwhois.x86_64 
ipmitool.x86_64 graphviz.x86_64 ImageMagick.x86_64 php-sodium.x86_64</a> |#|#| Установка необходимых пакетов для дальнейшей работы
------------
Если после выполнения команды не установились некоторые пакеты, то не нужно паниковать! Это все исправится далее.
------------
<a class="neonText2">systemctl enable sshd</a> |#|#| Команда для добавления в автозапуск службы "sshd"
------------
<a class="neonText2">systemctl start sshd</a> |#|#| Команда для включения службы "sshd"
------------
<a class="neonText2">yum install -y libvirt.x86_64</a> |#|#| Команда установки пакета "libvirt" для добавления возможности отслеживания виртуальных машин
------------
<a class="neonText2">yum install -y yum-utils</a> |#|#| Команда для установки пакета "yum-utils"
------------
<a class="neonText2">yum-config-manager --enable remi-php71</a> |#|#| Команда для активации репозитория "remi-php71"
------------
<a class="neonText2">yum-config-manager --enable php-pecl-libsodium</a> |#|#| Команда для активации репозитория "php-pecl-libsodium"
------------
<a class="neonText2">yum-config-manager --enable php-pecl-libsodium2</a> |#|#| Команда для активации репозитория "php-pecl-libsodium2"
------------
<a class="neonText2">yum update -y</a> |#|#| Команда для обновления пакетов после активации репозиториев
------------
<a class="neonText2">yum install -y wget.x86_64 httpd.x86_64 php.x86_64 php-opcache.x86_64 php-mysql.x86_64 php-gd.x86_64 php-posix php-pear.noarch cronie.x86_64 net-snmp.x86_64 
net-snmp-utils.x86_64 fping.x86_64 mariadb-server.x86_64 mariadb.x86_64 MySQL-python.x86_64 rrdtool.x86_64 subversion.x86_64  jwhois.x86_64 ipmitool.x86_64 
graphviz.x86_64 ImageMagick.x86_64 php-sodium.x86_64</a> |#|#| Команда для повторной установки пакетов
------------
<a class="neonText2">yum --enablerepo=remi-php72 install php-sodium</a> |#|#| Команда для активации репозитория "remi-php72" и установки пакета "php-sodium"
------------
<a class="neonText2">yum update -y</a> |#|#| Команда для обновления пакетов после активации репозитория
------------
<a class="neonText2">mkdir -p /opt/observium && cd /opt</a> |#|#| Команда для создания папки "observium" и перехода в каталог "/opt/"
------------
<a class="neonText2">wget http://www.observium.org/observium-community-latest.tar.gz</a> |#|#| Команда для скачивания архива "observium-community-latest.tar.gz"
------------
<a class="neonText2">tar zxvf observium-community-latest.tar.gz</a> |#|#| Команда для распаковки архива "observium-community-latest.tar.gz"
--------------------------------------------------------------------------------------------------------------------------------------------------------------
6) Настройка базы данных MySQL для ПО Observium.
------------
<a class="neonText2">systemctl enable mariadb</a> |#|#| Команда для добавления в автозапуск службы "mariadb"
------------
<a class="neonText2">systemctl start mariadb</a> |#|#| Команда для включения службы "mariadb"
------------
<a class="neonText2">/usr/bin/mysqladmin -u root password</a> |#|#| Команда для создания пароля пользователю "root" в системе по управлению базами данных
------------
<a class="neonText2">mysql -u root -p</a> |#|#| Команда для входа в систему по управлению базами данных
------------
<a class="neonText2">CREATE DATABASE observium DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci;</a> |#|#| Команда для создания базы данных "observium"
------------
<a class="neonText2">GRANT ALL PRIVILEGES ON observium.* TO 'root'@'localhost' IDENTIFIED BY 'LogoP@ssYour';</a> |#|#| Команда для предоставления всех привилегий пользователю "root" 
для базы данных "observium"
------------
<a class="neonText2">Exit;</a> |#|#| Команда для выхода из системы по управлению базами данных
--------------------------------------------------------------------------------------------------------------------------------------------------------------
7) Настройка и запуск ПО Observium с дальнейшей настройкой зависимостей.
------------
<a class="neonText2">cd observium</a> |#|#| Команда для перехода в каталог "observium"
------------
<a class="neonText2">cp config.php.default config.php</a> |#|#| Копирование файла "config.php.default" с новым названием "config.php"
------------
<a class="neonText2">nano config.php</a> |#|#| Команда для редактирования файла "config.php"
------------
В данный файл нужно внести следующие изменения:
<a class="neonText2">
// Database config
$config['db_host'] = 'localhost';
$config['db_user'] = 'root';
$config['db_pass'] = 'LogoP@ssYour';
$config['db_name'] = 'observium';</a>
------------
В конец файла добавить строку: "/usr/sbin/fping";
------------
<a class="neonText2">./discovery.php -u</a> |#|#| Команда для запуска сценария discovery.php с ключом обновления -u, чтобы вставить исходную схему MySQL
------------
<a class="neonText2">mkdir rrd</a> |#|#| Команда для создания папки "rrd"
------------
<a class="neonText2">chown apache:apache rrd</a> |#|#| Команда для присвоения каталогу "rrd" пользователя "apache" и группы "apache"
------------
<a class="neonText2">nano /etc/httpd/conf.d/observium.conf</a> |#|#| Команда для редактирования файла "observium.conf"
------------
Если на сервере будет работать только ПО Observium, то внесите в файл "observium.conf" следующее содержимое:
<a class="neonText2">
&lt;VirtualHost *&gt;
   DocumentRoot /opt/observium/html/
   ServerName  observium.domain.com
   CustomLog /opt/observium/logs/access_log combined
   ErrorLog /opt/observium/logs/error_log
   &lt;Directory "/opt/observium/html/"&gt;
     AllowOverride All
     Options FollowSymLinks MultiViews
     Require all granted
   &lt;/Directory&gt;
&lt;/VirtualHost&gt;</a>
------------
<a class="neonText2">mkdir /opt/observium/logs</a> |#|#| Команда для создания папки "logs"
------------
<a class="neonText2">chown apache:apache /opt/observium/logs</a> |#|#| Команда для присвоения каталогу "logs" пользователя "apache" и группы "apache"
------------
<a class="neonText2">cd /opt/observium</a> |#|#| Команда для перехода в каталог "/opt/observium/"
------------
<a class="neonText2">./adduser.php admin Logo_P@ss_Your 10</a> |#|#| Команда для создания пользователя "admin" с паролем "Logo_P@ss_Your" и полными привилегиями для работы в ПО Observium
------------
<a class="neonText2">touch /etc/cron.d/observium</a> |#|#| Команда для создания файла "observium" в каталоге "/etc/cron.d/"
------------
<a class="neonText2">nano /etc/cron.d/observium</a> |#|#| Команда для редактирования файла "observium"
------------
В данный файл нужно вставить следующие строки:
<a class="neonText2">
33 */6 * * * root /opt/observium/discovery.php -h all >> /dev/null 2>&1
*/5 * * * * root /opt/observium/discovery.php -h new >> /dev/null 2>&1
*/5 * * * * root /opt/observium/poller-wrapper.py 2 >> /dev/null 2>&1</a>
------------
<a class="neonText2">systemctl restart crond</a> |#|#| Команда для перезапуска службы "crond"
------------
<a class="neonText2">systemctl status crond</a> |#|#| Команда для просмотра статуса службы "crond"
------------
<a class="neonText2">systemctl enable crond</a> |#|#| Команда для добавления в автозапуск службы "crond"
--------------------------------------------------------------------------------------------------------------------------------------------------------------
8) Настройка Firewall.
------------
<a class="neonText2">systemctl status httpd</a> |#|#| Команда для просмотра статуса службы "httpd"
------------
<a class="neonText2">systemctl start httpd</a> |#|#| Команда для запуска службы "httpd"
------------
<a class="neonText2">systemctl enable httpd</a> |#|#| Команда для добавления в автозапуск службы "httpd"
------------
<a class="neonText2">firewall-cmd --permanent --zone=public --add-service=http</a> |#|#| Команда для открытия публичного доступа к сайту с ПО Observium
------------
<a class="neonText2">firewall-cmd --reload</a> |#|#| Команда для перезагрузки службы "firewalld"
------------
Чтобы удостовериться в том, что у поднятое ПО Observium корректно работает, рекомендую выполнить перезагрузку сервера:
------------
<a class="neonText2">reboot</a> |#|#| Команда для перезагрузки сервера
--------------------------------------------------------------------------------------------------------------------------------------------------------------
9) Горячие комбинации.
------------
Все описанные ниже команды выполняются в каталоге "/opt/observium"
------------
<a class="neonText2">cd /opt/observium/</a> |#|#| Команда для перехода в каталог Observium
------------
<a class="neonText2">./discovery.php -h all</a>  |#|#| \
                        |#|#|  ---  Команды для опроса добавленного сервера/сетевого устройства в ПО Observium(на тот случай, чтобы не жадть пока отработает
<a class="neonText2">./poller.php -h all</a>     |#|#| /     служба "crond").
--------------------------------------------------------------------------------------------------------------------------------------------------------------
На этом инструкция закончена! Спасибо за внимание!
</p>
</div>
