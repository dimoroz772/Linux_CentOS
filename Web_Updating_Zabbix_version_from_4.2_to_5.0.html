<head>
  <title>Updating Zabbix version from 4.2 to 5.0</title>
  <link rel="shortcut icon" href="./CentOS_Logo.png" type="image/png">
</head>
 <head>
  <meta charset="utf-8">
 </head>
<style>
.neonText1 {
  color: #87CEFA;
  text-shadow:
      0 0 1px #4169E1,
      0 0 1px #4169E1,
      0 0 1px #4169E1,
      0 0 1px #4169E1,
      0 0 1px #4169E1,
      0 0 1px #4169E1,
      0 0 1px #4169E1,
      0 0 1px #4169E1;
}
.neonText2 {
  color: #00FF00;
  text-shadow:
      0 0 1px #006400,
      0 0 1px #006400,
      0 0 1px #006400,
      0 0 1px #006400,
      0 0 1px #006400,
      0 0 1px #006400,
      0 0 1px #006400,
      0 0 1px #006400;
}
/* Additional styling */
body{
    background-color: black;
    background-repeat: no-repeat;
    background-size: cover;
    background-attachment: fixed;
    max-width: 1400px;
    margin: 0 auto;
    padding: 20px;
    color: #cfcfcf;
}
a {
    text-decoration: none;
}
p {
  text-indent: 1.5em;
  font-family: monospace;
  font-weight: 500;
  white-space: pre;
  line-height: 2;
  letter-spacing: 1px;
}
</style>
<div class="container">
<p class="neonText1">
Обновление сервера с свободной системой мониторинга статусов разнообразных сервисов компьютерной сети, серверов и сетевого оборудования Zabbix с версии 4.2 до 5.0 на ОС Linux CentOS 7
--------------------------------------------------------------------------------------------------------------------------------------------------------------
Все описанные ниже действия выполнялись под пользователем root
--------------------------------------------------------------------------------------------------------------------------------------------------------------
Всем привет! Для реализации данного проекта мне потребовалось:
1) Остановить сервер Zabbix;
2) Backup DB;
3) Backup PHP-скриптов;
4) Подключить репозиторий с версией Zabbix 5.0;
5) Очистить и пересоздать кэш пакетов yum;
6) Обновить Zabbix.
--------------------------------------------------------------------------------------------------------------------------------------------------------------
1) Остановка сервера Zabbix.
------------
<a class="neonText2">systemctl stop zabbix-server</a> |#|#| Команда для остановки службы "zabbix-server"
--------------------------------------------------------------------------------------------------------------------------------------------------------------
2) Backup DB.
------------
<a class="neonText2">/usr/bin/mysqldump --opt -v --databases zabbix -uzabbix -p'password' | /usr/bin/gzip -c > /root/zabbix.sql.gz</a> |#|#| Команда для выполнения бэкапа БД
------------
Расшифровка:

zabbix - название базы данных Zabbix
-uzabbix - ключ -u, а дальше имя пользователя базы данных
-p’password’ - ключ -p, а дальше пароль пользователя БД, если в пароле есть спецсимволы, экранируйте их одиночными кавычками
--------------------------------------------------------------------------------------------------------------------------------------------------------------
3) Backup PHP-скриптов.
------------
<a class="neonText2">cp -R /usr/share/zabbix /root</a> |#|#| Команда сохранения php скриптов
--------------------------------------------------------------------------------------------------------------------------------------------------------------
4) Подключение репозитория с версией Zabbix 5.0.
------------
<a class="neonText2">rpm -Uvh https://repo.zabbix.com/zabbix/5.0/rhel/7/x86_64/zabbix-release-5.0-1.el7.noarch.rpm</a> |#|#| Команда для подключения репозитория с версией Zabbix 5.0(Старый репозиторий от версии 4.4 будет автоматически удален)
--------------------------------------------------------------------------------------------------------------------------------------------------------------
5) Очистка и пересоздание кэша пакетов yum.
------------
<a class="neonText2">yum clean all</a> |#|#| Команда для очистки кэша всех пакетов и метаданных
------------
<a class="neonText2">yum makecache</a> |#|#| Команда для пересоздания кэша всех пакетов
--------------------------------------------------------------------------------------------------------------------------------------------------------------
6) Обновление Zabbix.
------------
<a class="neonText2">yum upgrade -y zabbix-server-mysql zabbix-web-mysql zabbix-web zabbix-agent zabbix-get zabbix-sender</a> |#|#| Команда для обновления пакетов ПО Zabbix
------------
<a class="neonText2">rpm -qa | grep zabbix</a> |#|#| Команда для просмотра установленных пакетов Zabbix и их версий
------------
<a class="neonText2">yum remove zabbix-web-*</a> |#|#| Команда для удаления старых пакетов Zabbix
------------
<a class="neonText2">yum install centos-release-scl</a> |#|#| Команда для подключения репозитория centos-release-scl
------------
<a class="neonText2">nano /etc/yum.repos.d/zabbix.repo</a> |#|#| Команда для открытия файла "zabbix.repo" в текстовом редакторе Nano
------------
Приведите строки в разделе "zabbix-frontend" в файле "zabbix.repo" к следующему виду:
<a class="neonText2">
[zabbix-frontend]name=Zabbix Official Repository frontend - $basearch
baseurl=http://repo.zabbix.com/zabbix/5.0/rhel/7/$basearch/frontend
enabled=1
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-ZABBIX-A14FE591</a>
------------
<a class="neonText2">yum install -y zabbix-web-mysql-scl zabbix-apache-conf-scl</a> |#|#| Команда для установки новых пакетов ПО Zabbix
------------
<a class="neonText2">yum update zabbix-*</a> |#|#| Команда для обновления существующих пакетов Zabbix
------------
<a class="neonText2">SetHandler "proxy:unix:/var/opt/rh/rh-php72/run/php-fpm/zabbix.sock|fcgi://localhost"</a> |#|#| Команда для проверки активировации нового конфига Zabbix для Apache.
------------
<a class="neonText2">systemctl restart zabbix-server</a> |#|#| Команда для перезапуска службы "zabbix-server"
------------
<a class="neonText2">systemctl enable --now rh-php72-php-fpm</a> |#|#| Команда для добавления службы "rh-php72-php-fpm" в автозагрузку
------------
<a class="neonText2">reboot</a> |#|#| Команда для перезагрузки АРМ/VM
--------------------------------------------------------------------------------------------------------------------------------------------------------------
На этом инструкция закончена! Спасибо за внимание!
</p>
</div>
