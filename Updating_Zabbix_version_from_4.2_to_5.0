Обновление сервера с свободной системой мониторинга статусов разнообразных сервисов компьютерной сети, серверов и сетевого оборудования Zabbix с версии 4.2 до 5.0 на ОС Linux CentOS 7
--------------------------------------------------------------------------------------------------------------------------------------------------------------
Все описанные ниже действия выполнялись под пользователем root
--------------------------------------------------------------------------------------------------------------------------------------------------------------
Всем привет! Для реализации данного проекта мне потребовалось:
1) Остановить сервер Zabbix;
2) Backup DB;
3) Backup PHP-скриптов;
4) Подключить репозиторий с версией Zabbix 5.0;
5) Очистить и пересоздать кэш пакетов yum;
6) Обновить Zabbix.
--------------------------------------------------------------------------------------------------------------------------------------------------------------
1) Остановка сервера Zabbix.
--------------------------------------------------------------------------------------------------------------------------------------------------------------
systemctl stop zabbix-server |#|#| Команда для остановки службы "zabbix-server"
--------------------------------------------------------------------------------------------------------------------------------------------------------------
2) Backup DB.
--------------------------------------------------------------------------------------------------------------------------------------------------------------
/usr/bin/mysqldump --opt -v --databases zabbix -uzabbix -p'password' | /usr/bin/gzip -c > /root/zabbix.sql.gz |#|#| Команда для выполнения бэкапа БД
------------
Расшифровка:
zabbix - название базы данных Zabbix
-uzabbix - ключ -u, а дальше имя пользователя базы данных
-p’password’ - ключ -p, а дальше пароль пользователя БД, если в пароле есть спецсимволы, экранируйте их одиночными кавычками
--------------------------------------------------------------------------------------------------------------------------------------------------------------
3) Backup PHP-скриптов.
--------------------------------------------------------------------------------------------------------------------------------------------------------------
cp -R /usr/share/zabbix /root |#|#| Команда сохранения php скриптов
--------------------------------------------------------------------------------------------------------------------------------------------------------------
4) Подключение репозитория с версией Zabbix 5.0.
--------------------------------------------------------------------------------------------------------------------------------------------------------------
rpm -Uvh https://repo.zabbix.com/zabbix/5.0/rhel/7/x86_64/zabbix-release-5.0-1.el7.noarch.rpm |#|#| Команда для подключения репозитория с версией Zabbix 5.0(Старый репозиторий от версии 4.4 будет автоматически удален)
--------------------------------------------------------------------------------------------------------------------------------------------------------------
5) Очищение и пересоздание кэша пакетов yum.
--------------------------------------------------------------------------------------------------------------------------------------------------------------
yum clean all |#|#| Команда для очистки кэша всех пакетов и метаданных
------------
yum makecache |#|#| Команда для пересоздания кэша всех пакетов
--------------------------------------------------------------------------------------------------------------------------------------------------------------
6) Обновление Zabbix.
--------------------------------------------------------------------------------------------------------------------------------------------------------------
yum upgrade -y zabbix-server-mysql zabbix-web-mysql zabbix-web zabbix-agent zabbix-get zabbix-sender |#|#| Команда для обновления пакетов ПО Zabbix
------------
rpm -qa | grep zabbix |#|#| Команда для просмотра установленных пакетов Zabbix и их версий
------------
yum remove zabbix-web-* |#|#| Команда для удаления старых пакетов Zabbix
------------
yum install centos-release-scl |#|#| Команда для подключения репозитория centos-release-scl
------------
nano /etc/yum.repos.d/zabbix.repo |#|#| Команда для открытия файла "zabbix.repo" в текстовом редакторе Nano
------------
Приведите строки в разделе "zabbix-frontend" в файле "zabbix.repo" к следующему виду:

[zabbix-frontend]name=Zabbix Official Repository frontend - $basearch
baseurl=http://repo.zabbix.com/zabbix/5.0/rhel/7/$basearch/frontend
enabled=1
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-ZABBIX-A14FE591
------------
yum install -y zabbix-web-mysql-scl zabbix-apache-conf-scl |#|#| Команда для установки новых пакетов ПО Zabbix
------------
yum update zabbix-* |#|#| Команда для обновления существующих пакетов Zabbix
------------
SetHandler "proxy:unix:/var/opt/rh/rh-php72/run/php-fpm/zabbix.sock|fcgi://localhost" |#|#| Команда для проверки активировации нового конфига Zabbix для Apache.
------------
systemctl restart zabbix-server |#|#| Команда для перезапуска службы "zabbix-server"
------------
systemctl enable --now rh-php72-php-fpm |#|#| Команда для добавления службы "rh-php72-php-fpm" в автозагрузку
------------
reboot |#|#| Команда для перезагрузки АРМ/VM
--------------------------------------------------------------------------------------------------------------------------------------------------------------
На этом инструкция закончена! Спасибо за внимание!
