Развертывание сервера Ansible SSH Access Manager на ОС Linux CentOS 7
--------------------------------------------------------------------------------------------------------------------------------------------------------------
Все описанные ниже действия выполнялись под пользователем root
--------------------------------------------------------------------------------------------------------------------------------------------------------------
Всем привет! Для реализации данного проекта мне потребовалось:
1) Обновить пакеты ОС Linux CentOS 7 до последней версии;
2) Прописать статические IP-адреса;
3) Установить необходимые пакеты/компоненты;
4) Сгенерировать ssh-ключи для пользователей;
--------------------------------------------------------------------------------------------------------------------------------------------------------------
Предисловие:
Ansible — система управления конфигурациями, написанная на языке программирования Python, с использованием декларативного языка разметки для описания 
конфигураций. Применяется для автоматизации настройки и развёртывания программного обеспечения.
------------
SSH — сетевой протокол прикладного уровня, позволяющий производить удалённое управление операционной системой и туннелирование TCP-соединений.
------------
Nano - это консольный текстовый редактор для UNIX и Unix-подобных операционных систем, основанный на библиотеке curses и распространяемый под лицензией 
GNU GPL.
------------
NMTUI - это инструмент командной строки, который используется для настройки сети в системах Gnu / Linux. При запуске он вызывает графический текстовый 
интерфейс, который помогает пользователям легко и эффективно настраивать сетевые интерфейсы.
------------
Ключ SSH — это криптографический безопасный идентификатор.
------------
EPEL (Extra Packages for Enterprise Linux) ― это открытое бесплатное хранилище пакетов от Fedora. Оно содержит пакеты дополнительного программного обеспечения
для Linux. Пакеты этого репозитория не конфликтуют с пакетами RHEL, поэтому этот репозиторий самый безопасный в использовании для CentOS.
--------------------------------------------------------------------------------------------------------------------------------------------------------------
1) Перед началом выполнения каких-либо манипуляций, нужно выполнить подготовку ОС Linux CentOS 7. Для начала обновим пакеты системы.
--------------------------------------------------------------------------------------------------------------------------------------------------------------
yum update -y && yum upgrade -y |#|#| Поиск и обновление пакетов системы
--------------------------------------------------------------------------------------------------------------------------------------------------------------
2) Также для избежания потери связи с АРМ/VM, нужно позаботиться о статической IP-адресации. Её можно настроить как на самой АРМ/VM, так и на самом сетевом устройстве.
Статическую адресацию можно прописать с помощью инструмента командной строки nmtui.
--------------------------------------------------------------------------------------------------------------------------------------------------------------
yum install -y NetworkManager-tui |#|#| Установка пакета nmtui для настройки сети на АРМ/VM.
--------------------------------------------------------------------------------------------------------------------------------------------------------------
Гайд по тому, как пользоваться инструментом nmtui, вы можете посмотреть в интернете.
--------------------------------------------------------------------------------------------------------------------------------------------------------------
3) Установка необходимых пакетов/компонентов.
--------------------------------------------------------------------------------------------------------------------------------------------------------------
yum install -y epel-release |#|#| Команда для подключения репозитория EPEL к OC
--------------------------------------------------------------------------------------------------------------------------------------------------------------
yum install -y ansible |#|#| Команда для установки ПО Ansible
--------------------------------------------------------------------------------------------------------------------------------------------------------------
cp /etc/ansible/hosts /etc/ansible/hosts.default |#|#| Команда для копирования файла "hosts" с новым именем "hosts.default"
После создания копии файла "hosts", можете его полностью очистить, чтобы было удобнее в нем работать.
--------------------------------------------------------------------------------------------------------------------------------------------------------------
4) Генерация ssh-ключей для пользователей и их использование.
--------------------------------------------------------------------------------------------------------------------------------------------------------------
Для того, чтобы пользоваться ПО Ansible, нужно обеспечить связь между самим сервером Ansible и клиентом. Для этого нужно создать ssh-ключи для пользователя
root. Я буду использовать в данном примере ssh-ключи формата RSA, но можно создать и таких форматов как:
- dsa
- ecdsa
- ecdsa-sk
- ed25519
- ed25519-sk
--------------------------------------------------------------------------------------------------------------------------------------------------------------
ssh-keygen -t rsa |#|#| Команда для генерации ssh-ключей формата RSA
При генерации ключей с помощью компонента ssh-keygen, также можно будет задать пути сохраниния создаваемых ключей и назначить парольную фразу, которую нужно
будет вводить для использования данного ключа. После выполнения данной команды, ключи "id_rsa" и "id_rsa.pub" можно будет найти по пути: /root/.ssh/id_rsa
--------------------------------------------------------------------------------------------------------------------------------------------------------------
После того, как ssh-ключи были сгенерированы, их нужно разложить по местам. 
Открытый (публичный ключ id_rsa.pub) -  используется для шифрования данных при обращении к серверу, находится у клиента(в нашем случае при обращении сервера 
Ansible к клиенту).
Закрытый (секретный ключ id_rsa) - используется для расшифровки данных, он находится у того, кто будет подключаться к серверу(в нашем случае на сервере Ansible).
------------
cd /root/.ssh |#|#| Команда для перехода в каталог "/root/.ssh"
--------------------------------------------------------------------------------------------------------------------------------------------------------------
ls |#|#| Команда для просмотра содержимого в каталоге "/root/.ssh"
--------------------------------------------------------------------------------------------------------------------------------------------------------------
Ключ id_rsa является закрытым, он должен храниться у владельца, в нашем случае, он будет лежать на сервере Ansible. Для удобства, его можно переместить в 
любое удобное место.
Ключ id_rsa.pub является открытым/публичным, его нужно будет положить на клиентскую ВМ в каталог "/root/.ssh" с названием "authorized_keys".
Для копирования ключа, используем команду "ssh-copy-id".
------------
ssh-copy-id -i ~/.ssh/id_rsa.pub root@10.10.10.10 |#|#| Команда для копирования ssh-ключа на нужную ВМ.

























