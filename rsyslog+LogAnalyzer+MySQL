Развертывание системы централизованного журналирования сетевых устройств на ОС Linux CentOS 7
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Все описанные ниже действия выполнялись под пользователем root
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Всем привет! Для реализации данного проекта мне потребовалось:
1) Обновить пакеты ОС Linux CentOS 7 до последней версии;
2) Прописать статические IP-адреса;
3) Выключить систему принудительного контроля доступа SELinux;
4) Установить необходимые пакеты/компоненты;
5) Настроить базу данных(MySQL) для rsyslog;
6) Скачать и установить ПО LogAnalyzer;
7) Запустить веб-установщик LogAnalyzer и подключить к созданной базе данных;
8) Подключить к rsyslog сетевое устройство.
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Предисловие:
LogAnalyzer - это программное обеспечение, устанавливаемое, как правило, на сервер, которое с определённой периодичностью собирает накопленные узлом журналы сервера, 
обрабатывающее данные из них, хранящее извлечённые данные во внутреннем архиве или базе данных, и создающее страницы, показывающие статистическую информацию конечным пользователям.
Rsyslog - это это программная утилита с открытым исходным кодом, используемая в UNIX и Unix-подобных компьютерных системах для пересылки сообщений журнала в сети.
MySQL - это свободная реляционная система управления базами данных.
MariaDB — это ответвление от системы управления базами данных MySQL, разрабатываемое сообществом под лицензией GNU GPL.
NMTUI - это инструмент командной строки, который используется для настройки сети в системах Gnu / Linux. При запуске он вызывает графический текстовый интерфейс, который помогает 
пользователям легко и эффективно настраивать сетевые интерфейсы.
SELinux - это система принудительного контроля доступа, реализованная на уровне ядра.
Nano - это консольный текстовый редактор для UNIX и Unix-подобных операционных систем, основанный на библиотеке curses и распространяемый под лицензией GNU GPL.
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
1) Перед началом выполнения каких-либо манипуляций по настройке связки rsyslog+LogAnalyzer+MySQL, нужно выполнить подготовку ОС Linux CentOS 7. Для начала обновим пакеты системы.
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
yum update -y && yum upgrade -y |#|#| Поиск и обновление пакетов системы
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
2) Также для избежания потери связи с ARM/VM, нужно позаботиться о статической IP-адресации. Её можно настроить как на самой ARM/VM, так и на самом сетевом устройстве.
Статическую адресацию можно прописать с помощью инструмента командной строки nmtui.
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
yum install -y NetworkManager-tui |#|#| Установка пакета nmtui для настройки сети на ARM/VM.
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Гайд по тому, как пользоваться инструментом nmtui, вы можете посмотреть в интернете.
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
3) После настройки сети, нужно ОБЯЗАТЕЛЬНО отключить систему контроля доступа SELinux НАВСЕГДА. Если данную систему не выключить, то после настройки LogAnalyzer, в нём же у вас все время 
будут сыпаться следующие ошибки:
1) file './...]': open error: Permission denied [v8.24.0-57.el7_9.3 try http://www.rsyslog.com [More Information] /e/2433 ]
2) action 'action 7' resumed (module 'builtin:omfile') [v8.24.0-57.el7_9.3 try http://www.rsyslog.com [More Information] /e/2359 ]
3) file './...]': open error: Permission denied [v8.24.0-57.el7_9.3 try http://www.rsyslog.com [More Information] /e/2433 ]
4) action 'action 8' resumed (module 'builtin:omfile') [v8.24.0-57.el7_9.3 try http://www.rsyslog.com [More Information] /e/2359 ]
5) action 'action 9' resumed (module 'ommysql') [v8.24.0-57.el7_9.3 try http://www.rsyslog.com [More Information] /e/2359 ]
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
sestatus |#|#| Команда для проверки статуса SELinux
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Откройте файл: config по пути: /etc/selinux/
Для редактирования файла можно воспользоваться консольным текстовым редактором nano. По тому как им пользоваться, всю информацию можно найти в интернете.
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
nano /etc/selinux/config |#|#| Команда для открытия и редактирования конфигурационного файла SELinux
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Конфигурационный файл SELinux должен выглядеть следующим образом:

# This file controls the state of SELinux on the system.
# SELINUX= can take one of these three values:
#       enforcing - SELinux security policy is enforced.
#       permissive - SELinux prints warnings instead of enforcing.
#       disabled - No SELinux policy is loaded.
SELINUX=disabled
# SELINUXTYPE= can take one of these two values:
#       targeted - Targeted processes are protected,
#       mls - Multi Level Security protection.
SELINUXTYPE=targeted

--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
После внесённых изменений, сохраняем файл, выходим из консольного текстового редактора и отправляем ARM/VM в перезагрузку
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
reboot |#|#| Команда для перезагрузки ARM/VM
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
После перезагрузки вашего устройства, можете снова ввести команду "sestatus" и убедиться в том, что у вас отключена система SELinux.
Вывод отключенной системы должен выглядеть вот так: 

SELinux status:                 disabled

--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
4) Установка и включение необходимых пакетов/компонентов.
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
yum install -y httpd php php-mysql wget mariadb-server rsyslog-mysql |#|#| Команда для установки необходимых пакетов
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
systemctl enable httpd && systemctl start httpd |#|#| Команда для включения сервиса httpd в автозагрузку и запуска сервиса httpd
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
systemctl enable mariadb && systemctl start mariadb |#|#| Команда для включения сервиса mariadb в автозагрузку и запуска сервиса mariadb
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
5) Настройка базы данных(MySQL) для rsyslog.
!!! Изначально, в базе данных MySQL, у пользователя root пароль не назначен. Поэтому, когда система попросит вас ввести пароль, просто нажмите Enter !!! 
!!! Также, когда вы работаете в системе MariaDB, то после того, как вы полностью ввели команду, ОБЯЗАТЕЛЬНО нужно поставить в конце символ ";" !!!
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
mysql -u root -p < /usr/share/doc/rsyslog-8.24.0/mysql-createDB.sql |#|#| Команда для импортации схемы базы данных rsyslog, предложенной по умолчанию.
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
mysql -u root -p |#|#| Команда подключения к системе MariaDB, для управления базами данных MySQL
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
GRANT ALL ON Syslog.* TO 'rsyslog'@'localhost' IDENTIFIED BY 'Password'; |#|#| Команда создания пользователя "rsyslog" с паролем "Password" для доступа к базе данных Syslog. Пароль

можете придумать свой.
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
FLUSH PRIVILEGES; |#|#| Команда для того, чтобы задать привилегии пользователя путем непосредственного внесения изменений в таблицы назначения привилегий.
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
exit |#|#| Команда выхода из системы MariaDB.
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
cp /etc/rsyslog.conf /etc/rsyslog.conf.org |#|#| Данной командой сделайте копию файла rsyslog.conf и поменяйте ему название на rsyslog.conf.org
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Далее откройте файл rsyslog.conf в текстовом редакторе и раскомментируйте следующие строки:

$ModLoad imudp
$UDPServerRun 514

$ModLoad imtcp
$InputTCPServerRun 514

--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Далее в конец того же файла добавьте следующие строки, которые создадут новое правило переадресации и загрузят модуль MySQL:

# Load the MySQL Module
module(load="ommysql")

#*.* :ommysql:127.0.0.1,Syslog_Database,syslog_user,password
*.* :ommysql:127.0.0.1,Syslog,rsyslog,Password
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
После редактирования файла rsyslog.conf, также выполните команду для перезагрузки сервиса rsyslog.
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
systemctl restart rsyslog |#|#| Команда для перезагрузки утилиты сервиса rsyslog
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Если выполнили все привильно, то никаких ошибок при перезагрузке или последующем запуске службы возникнуть не должно. Также можно проверить состояние службы.
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
systemctl status rsyslog |#|#| Команда проверки статуса службы rsyslog
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
6) Загрузка, установка и настройка ПО LogAnalyzer.
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Превым этапом нужно скачать установочный архив с ПО LogAnalyzer.
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
cd /tmp |#|#| Команда для перехода в папку tmp 
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
wget http://download.adiscon.com/loganalyzer/loganalyzer-4.1.10.tar.gz |#|#| Команда для загрузки архива с ПО LogAnalyzer
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
tar -xzvf loganalyzer-4.1.10.tar.gz |#|#| Команда разархивации архива с ПО LogAnalizer
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
mkdir /var/www/html/loganalyzer |#|#| Команда для создания каталога "loganalyzer" в веб-каталоге apache
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
cp -r /tmp/loganalyzer-4.1.10/src/* /var/www/html/loganalyzer     |#|#| 
                                                                  |#|#| - Команды для копирования установочных файлов в каталог "loganalyzer"
cp -r /tmp/loganalyzer-4.1.10/contrib/* /var/www/html/loganalyzer |#|#| 
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
cd /var/www/html/loganalyzer |#|#| Команда перехода в каталог "loganalyzer"
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
touch config.php |#|#| Команда для создания файла "config.php"
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
chown apache:apache config.php |#|#| Данной командой изменим владельца и группу у файла "config.php" на apache:apache
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
chmod 777 config.php |#|#| Данной командой выдадим файлу "config.php" права на чтение, запись и выполнение
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
chcon -h -t httpd_sys_script_rw_t /var/www/html/loganalyzer/config.php |#|#| Данной командой изменим контекст файла "config.php"
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
7) Запуск веб-установщика LogAnalyzer и подключение к базе данных.
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Для последующей настройки LogAnalyzer, нужно перейти по следующему адресу: http://localhost/loganalyzer
Если вы хотите производить дальнейшую настройку на другом ARM/VM, то перейдите по следующему адресу: http://IP/loganalyzer Указав вместо "IP" адрес ARM/VM, на которой развернута связка rsyslog+LogAnalyzer+MySQL
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Далее следуйте прописанным ниже шагам:
1) В высветившемня окошке с текстом, вы увидите слово "here" синего цвета, кликайте на него;
2) Нажмите на кнопку "Next";
3) Убедитесь в том, что файл "config.php" доступен для записи и нажмите кнопку "Next";
4) Заполните данные базы данных для loganalyzer, указав имя базы данных: "Syslog", пользователя: "rsyslog" и пароль: "Password", созданные на последних шагах, и нажмите кнопку "Next".
5) Нажмите на кнопку "Next";
6) Нажмите на кнопку "Next";
7) Создайте учётную запись администратора для LogAnalyzer;
8) Заполните следующие строки:
    Name of the Source: My Syslog Source
    Source Type: MYSQL Native
    Select View: Syslog Fields
    Table type: MonitorWare
    Database Host: localhost
    Database Name: Syslog
    Database Tablename: systemevents
    Database User: rsyslog
    Database Password: Password
    Enable Row Counting: Yes
    
    Нажмите на кнопку "Next".
9) Нажмите на кнопку "Finish!".
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
После проделанных действий, у вас появится окошко, где нужно будет произвести авторизацию. В нём укажите учетные данные, которые вы создали в шаге №7.
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Если вы все сделали правильно, то после логирования у вас появится таблица с данными. Если же вы сделали что-то не так, то у вас после логирования появится ошибка, то вы что-то сделали не так.
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------





















