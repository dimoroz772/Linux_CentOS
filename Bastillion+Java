Установка и настройка связки Bastillion+Java на ОС Linux CentOS 7
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Все описанные ниже действия выполнялись под пользователем root
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Всем привет! Для реализации данного проекта мне потребовалось:
1) Установить ОС Linux CentOS 7 и обновить все пакеты;
2) Прописать статическую IP-адресацию;
3) Установить и настроить графическую оболочку GNOME Desktop;
4) Скачать и установить пакет Java;
5) Скачать и распаковать ПО Bastillion;
6) Открыть порт 8443 для TCP\UDP;
7) Создать исполняемый файл для запуска ПО Bastillion;
8) Создать службу и включить её в автозапуск вместе с загрузкой OC CentOS 7.
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Предисловие:
------------
NMTUI - это инструмент командной строки, который используется для настройки сети в системах Gnu / Linux. При запуске он вызывает графический текстовый интерфейс, который помогает 
пользователям легко и эффективно настраивать сетевые интерфейсы.
------------
OpenJDK — проект по созданию полностью совместимого Java Development Kit, состоящего исключительно из свободного и открытого исходного кода.
------------
Bastillion - это Web-интерфес с ПО, с помощью которого можно управлять ssh-ключами сотрудников организации.
------------
Nano - консольный текстовый редактор для UNIX и Unix-подобных операционных систем, основанный на библиотеке curses и распространяемый под лицензией GNU GPL.
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
1) Перед началом выполнения каких-либо манипуляций по настройке связки Bastillion+Java, нужно выполнить подготовку ОС Linux CentOS 7. Для начала обновим пакеты системы.
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
yum update -y && yum upgrade -y |#|#| Поиск и обновление пакетов системы
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
2) Также для избежания потери связи с АРМ/VM, нужно позаботиться о статической IP-адресации. Её можно настроить как на самой АРМ/VM, так и на самом сетевом устройстве.
Статическую адресацию можно прописать с помощью инструмента командной строки nmtui.
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
yum install -y NetworkManager-tui |#|#| Установка пакета nmtui для настройки сети на АРМ/VM
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Гайд по тому, как пользоваться инструментом nmtui, вы можете посмотреть в интернете.
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
3) Установка и настройка графической оболочки GNOME Desktop. Установка графической оболочки на OC Linux CentOS 7 по желанию.
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
yum -y groups install "GNOME Desktop" |#|#| Команда установки всех пакетов, которые связаны с GNOME GUI
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
echo "exec gnome-session" >> ~/.xinitrc |#|#| Данная команда указывает программе "X Window System", какой графический интерфейс будет грузиться по умолчанию(в нашем случае GNOME).
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
startx |#|#| Команда для проверки работоспособности графического интерфейса. После проверки, для отмены выполните комбинацию клавиш "Ctrl+C".
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
systemctl set-default graphical.target |#|#| Команда для выполнение автоматического запуска программы "startx" при загразке OC
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
reboot |#|#| Команда для перезагрузки OC
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
4) Скачивание и установка пакета Java
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Нужный пакет Java вы можете скачать по следующей сслыке: https://www.oracle.com/java/technologies/downloads/
В нашем случае нужен пакет: x64 RPM Package
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
После скачивания установочного пакета Java, вы можете его установить как используя графическую оболочку, так и через консоль.
cd /home/user/Downloads/ |#|#| Команда перехода в каталог с загрузками
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
yum install -y jdk-19_linux-x64_bin.rpm |#|#| Команда установки скачанного пакета Java
На этом установка пакета Java закончена.
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
5) Скачивание и распаковка ПО Bastillion
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Скачать архив с ПО Bastillion вы можете по данной ссылке: https://github.com/bastillion-io/Bastillion#bastillion
Также оставлю ссылку на сайт производителя ПО Bastillion: https://www.bastillion.io/docs/index.html
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
cd /home/user/Downloads/ |#|#| Команда перехода в каталог с загрузками
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
tar xfz bastillion-jetty-vXX.XX.tar.gz -C /opt/ |#|#| Команда для распаковки архива в каталог "/opt/"
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
export JAVA_HOME=/path/to/jdk     \
                                    --- Команды для экспортирования переменных среды. Эти команды выполняются для того, чтобы в дальнейшем скрипт для запуска ПО Bastillion корректно работал
export PATH=$JAVA_HOME/bin:$PATH  /
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
cd /opt/Bastillion-jetty/ |#|#| Команда для перехода в каталог "/opt/Bastillion-jetty/"
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
./startBastillion.sh |#|#| Команда запуска скрипта для проверки работоспособности ПО Bastillion. После запуска скрипта, в командной строке вам нужно будет ввести пароль, введите пароль от
 пользователя "root". 
Для проверки зайдем на Web-интерфейс Bastillion: https:IP-Address:8443 |#|#| Вместо слова IP-Address вписываете адрес вашей VM. В данном случае, заходить на Web-интерфейс Bastillion нужно
на самой VM с установленным ПО. Так как порт 8443 по умолчанию на VM не открыт в Firewall. После проверки работоспособности, в командной сроке, где вы запускали скрипт, выполните комбинацию
клавиш "Ctrl+C".
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
6) Открытие порта 8443 для TCP\UDP
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
firewall-cmd --state |#|#| Команда для просмотра состояния службы "Firewall-cmd"
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
yum install -y firewalld |#|#| Команда для установки пакета "Firewalld"
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
systemctl enable firewalld |#|#| Команда для автозагруки службы "Firewall-cmd" с загрузкой OC
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
systemctl start firewalld |#|#| Команда запуска службы "Firewall-cmd"
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
firewall-cmd --list-all |#|#| Команда для просмотра настроек службы "Firewall-cmd"
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
firewall-cmd --add-port=8443/tcp |#|#| Команда для открытия порта 8443 по просоколу TCP
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
firewall-cmd --add-port=8443/udp |#|#| Команда для открытия порта 8443 по просоколу UDP
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
firewall-cmd --runtime-to-permanent |#|#| Сохранение настроек службы "Firewall-cmd"
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
reboot |#|#| Команда для перезагрузки OC
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
7) Создание исполняемого файла для запуска ПО Bastillion
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
mkdir /root/scripts/ |#|#| Команда для создания папки "scripts" в каталоге "/root/"
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
cd /root/scripts/ |#|#| Команда для перехода в каталог "/root/scripts"
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
touch run.bastillion.sh |#|#| Команда для создания файла "run.bastillion.sh"
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
nano run.bastillion.sh |#|#| Открываем файл "run.bastillion.sh" в текстовом редакторе и приводим к следующему виду:

#!/bin/bash
# This is a comment

cd /opt/Bastillion.sh
./startBastillion.sh
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
После внесенных изменений сохраняем файл "run.bastillion.sh"
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
chmod u+x run.bastillion.sh |#|#| Данная команда делает файл "run.bastillion.sh" исполняемым
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
8) Создание службы и включение её в автозапуск вместе с загрузкой OC CentOS 7
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
cd /etc/systemd/system/ |#|#| Команда для перехода в каталог "/etc/systemd/system/"
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
touch bastillion.service |#|#| Команда для создания файла "bastillion.service"
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
nano bastillion.service |#|#| Открываем файл "bastillion.service" в текстовом редакторе и приводим к следующему виду:

[Unit]
Description=Run a Custom Script at Startup
After=default.target

[Service]
ExecStart=/root/scripts/run.bastillion.sh

[Install]
WantedBy=default.target
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
После внесенных изменений сохраняем файл "bastillion.service"
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
systemctl daemon-reload |#|#| Команда для перезагрузки подсистемы инициализации и управления службами 
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
systemctl enable bastillion.service |#|#| Включаем в автозагрузку службу "bastillion.service" вместе с загрузкой OC
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
reboot |#|#| Команда для перезагрузки OC
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Если после перезагрузки OC у вас запустился Web-интерфест ПО Bastillion, то вы все сделали правильно! Дальше настраивайте ПО под себя и свою организацию.
На этом инструкция закончена! Спасибо за внимание!)
