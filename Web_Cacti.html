<head>
  <title>Cacti</title>
  <link rel="shortcut icon" href="./CentOS_Logo.png" type="image/png">
</head>
 <head>
  <meta charset="utf-8">
 </head>
<style>
.neonText1 {
  color: #87CEFA;
  text-shadow:
      0 0 1px #4169E1,
      0 0 1px #4169E1,
      0 0 1px #4169E1,
      0 0 1px #4169E1,
      0 0 1px #4169E1,
      0 0 1px #4169E1,
      0 0 1px #4169E1,
      0 0 1px #4169E1;
}
.neonText2 {
  color: #00FF00;
  text-shadow:
      0 0 1px #006400,
      0 0 1px #006400,
      0 0 1px #006400,
      0 0 1px #006400,
      0 0 1px #006400,
      0 0 1px #006400,
      0 0 1px #006400,
      0 0 1px #006400;
}
/* Additional styling */
body{
    background-color: black;
    background-repeat: no-repeat;
    background-size: cover;
    background-attachment: fixed;
    max-width: 1400px;
    margin: 0 auto;
    padding: 20px;
    color: #cfcfcf;
}
a {
    text-decoration: none;
}
p {
  text-indent: 1.5em;
  font-family: monospace;
  font-weight: 500;
  white-space: pre;
  line-height: 2;
  letter-spacing: 1px;
}
</style>
<div class="container">
<p class="neonText1">
Развертывание сервера с системой мониторинга Cacti на ОС Linux CentOS 7
--------------------------------------------------------------------------------------------------------------------------------------------------------------
Все описанные ниже действия выполнялись под пользователем root
--------------------------------------------------------------------------------------------------------------------------------------------------------------
Всем привет! Для реализации данного проекта мне потребовалось:
1) Прописать статические IP-адреса;
2) Обновить пакеты ОС Linux CentOS 7 до последней версии;
3) Отключить систему принудительного контроля доступа SELinux;
4) Подключить репозиторий ОС Fedora;
5) Установить пакета Apache;
6) Установить пакеты SNMP and RRDTool;
7) Установить пакеты сервера MariaDB и первоначальная настройка;
8) Установить пакет PHP и дополнительные для его корректной работы пакеты;
9) Создать базу данных для Cacti;
10) Оптимизировать базу данных;
11) Установить пакет yum-utils;
12) Обновить пакеты PHP с версии 5 до более свежей;
13) Установить и настроить Cacti;
14) Настроить Cron;
15) Настроить Apache для Cacti;
16) Настроить Firewall;
17) Настроить Cacti через Web-интерфейс перед использованием.
--------------------------------------------------------------------------------------------------------------------------------------------------------------
Предисловие:
------------
Cacti — open-source веб-приложение, система позволяет строить графики при помощи RRDtool. Cacti собирает статистические данные за определённые 
временные интервалы и позволяет отобразить их в графическом виде.
------------
SELinux — реализация системы принудительного контроля доступа, которая может работать параллельно с классической избирательной системой контроля доступа.
------------
EPEL (Extra Packages for Enterprise Linux) ― это открытое бесплатное хранилище пакетов от Fedora. Оно содержит пакеты дополнительного программного обеспечения
для Linux. Пакеты этого репозитория не конфликтуют с пакетами RHEL, поэтому этот репозиторий самый безопасный в использовании для CentOS.
------------
Remi - это хранилище yum-репозиториев. Хранилище Remi предоставляет разнообразные up-to-date пакеты, которые очень полезны или являются необходимыми для многих 
популярных веб-сервисов.
------------
Cron — классический демон, использующийся для периодического выполнения заданий в определённое время. Регулярные действия описываются инструкциями, помещенными
в файлы crontab и в специальные каталоги.
--------------------------------------------------------------------------------------------------------------------------------------------------------------
1) Для избежания потери связи с АРМ/VM, нужно позаботиться о статической IP-адресации. Её можно настроить как на самой АРМ/VM, так и на самом сетевом 
устройстве. Статическую адресацию можно прописать с помощью инструмента командной строки nmtui.
--------------------------------------------------------------------------------------------------------------------------------------------------------------
<a class="neonText2">yum install -y NetworkManager-tui</a> |#|#| Установка пакета nmtui для настройки сети на АРМ/VM
--------------------------------------------------------------------------------------------------------------------------------------------------------------
Гайд по тому, как пользоваться инструментом nmtui, вы можете посмотреть в интернете.
--------------------------------------------------------------------------------------------------------------------------------------------------------------
2) Обновление пакетов системы.
--------------------------------------------------------------------------------------------------------------------------------------------------------------
<a class="neonText2">yum update -y && yum upgrade -y</a> |#|#| Поиск и обновление пакетов системы
--------------------------------------------------------------------------------------------------------------------------------------------------------------
3) Отключение системы принудительного контроля доступа SELinux.
--------------------------------------------------------------------------------------------------------------------------------------------------------------
<a class="neonText2">nano /etc/sysconfig/selinux</a> |#|#| Команда для открытия конфигурационного файла "selinux"
------------
В конфигурационном файле замените строку SELINUX=enforcing на SELINUX=disabled. Перед закрытием обязательно сохраните файл!
------------
Конфигурационный файл SELinux должен выглядеть следующим образом:
<a class="neonText2">
# This file controls the state of SELinux on the system.
# SELINUX= can take one of these three values:
#       enforcing - SELinux security policy is enforced.
#       permissive - SELinux prints warnings instead of enforcing.
#       disabled - No SELinux policy is loaded.
SELINUX=disabled
# SELINUXTYPE= can take one of these two values:
#       targeted - Targeted processes are protected,
#       mls - Multi Level Security protection.
SELINUXTYPE=targeted</a>
--------------------------------------------------------------------------------------------------------------------------------------------------------------
<a class="neonText2">reboot</a> |#|#| Команда для перезагрузки ARM/VM
--------------------------------------------------------------------------------------------------------------------------------------------------------------
После перезагрузки вашего устройства, можете снова ввести команду "sestatus" и убедиться в том, что у вас отключена система SELinux.
Вывод отключенной системы должен выглядеть вот так: 

SELinux status:                 disabled

--------------------------------------------------------------------------------------------------------------------------------------------------------------
4) Подключение репозитория ОС Fedora.
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
<a class="neonText2">rpm -Uvh https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm</a> |#|#| Команда обновления EPEL-репозитория
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Для дальнейшей настройки ВМ, обязательно понадобится пакет wget.
------------
<a class="neonText2">yum install -y wget</a> |#|#| Команда для установки пакета "wget"
------------
<a class="neonText2">wget http://rpms.famillecollet.com/enterprise/remi-release-7.rpm</a> |#|#| Команда для скачивания пакета "Remi" из репозитория 
------------
<a class="neonText2">rpm -Uvh remi-release-7.rpm</a> |#|#| Обновление/установка пакета "Remi"
------------
<a class="neonText2">yum repolist</a> |#|#| Команда для просмотра всех подключенных репозиториев
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
5) Установка пакета Apache.
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
<a class="neonText2">yum install -y httpd httpd-devel</a> |#|#| Команда для установки пакета "Apache"
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
<a class="neonText2">systemctl start httpd</a> |#|#| Команда для запуска службы "httpd"
------------
<a class="neonText2">systemctl enable httpd</a> |#|#| Команда для добавления службы "httpd" в автозапуск ОС
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
6) Установка пакетов SNMP and RRDTool.
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
<a class="neonText2">yum  install -y net-snmp net-snmp-utils net-snmp-libs rrdtool</a> |#|#| Команда для установки пакетов "SNMP" и "RRDTool"
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
<a class="neonText2">systemctl start snmpd</a> |#|#| Команда для запуска службы "snmp"
------------
<a class="neonText2">systemctl enable snmpd</a> |#|#| Команда для добавления службы "snmp" в автозапуск ОС
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
7) Установка пакетов сервера MariaDB и первоначальная настройка.
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
<a class="neonText2">yum install mariadb-server</a> |#|#| Команда для установки пакетов "сервера MariaDB"
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
<a class="neonText2">systemctl start mariadb</a> |#|#| Команда для запуска службы "mariadb"
------------
<a class="neonText2">systemctl enable mariadb</a> |#|#| Команда для добавления службы "mariadb" в автозапуск ОС
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Далее нужно завершить установку Mariadb следующей командой: mysql_secure_installation. Далее нужно будет ответить на следующие вопросы:
------------
<a class="neonText2"># mysql_secure_installation</a>
------------
Enter current password for root (enter for none): |#|#| Так как пароля для пользователя "root" ранее задано не было, на данный вопрос ответьте клавишей "Enter"
------------
Set root password? [Y/n] Y |#|#| Вопрос для установки пароля для пользователя "root"
New password:              |#|#| Строка для ввода нового пароля для пользователя "root"
Re-enter new password:     |#|#| Строка для повторения нового пароля для пользователя "root"
------------
Remove anonymous users? [Y/n] Y |#|#| Вопрос для удаления анонимных пользователей
------------
Disallow root login remotely? [Y/n] Y |#|#| Вопрос запрета удаленного входа под пользователем "root"
------------
Remove test database and access to it? [Y/n] Y |#|#| Вопрос удаления тестовой базы данных и доступа к ней
------------
Reload privilege tables now? [Y/n] Y |#|#| Вопрос о перезагрузке таблицы привилегий
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
8) Установка пакета PHP и дополнительных для его корректной работы пакетов.
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
<a class="neonText2">yum --enablerepo=remi install -y php-mysql php-pear php-common php-gd php-devel php php-mbstring php-cli php-intl php-snmp</a> |#|#| Команда для установки набора пакетов, связанных с PHP
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
9) Создание базы данных для Cacti.
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
<a class="neonText2">mysql -u root -p</a> |#|#| Команда для входа в систему по управлению базами данных
------------
<a class="neonText2">create database cacti;</a> |#|#| Команда для создания базы данных с наименованием "cacti"
------------
<a class="neonText2">CREATE USER 'cacti'@'localhost' IDENTIFIED BY 'cacti';</a> |#|#| Команда для создания пользователя "cacti" с паролем "cacti"
------------
<a class="neonText2">grant all privileges on cacti.* to cacti@localhost;</a> |#|#| Команда для предоставления всех привилегий пользователю "cacti" для базы данных "cacti"
------------
<a class="neonText2">FLUSH PRIVILEGES;</a> |#|#| Команда выдачи полных привилегий
------------
<a class="neonText2">Exit;</a> |#|#| Команда для выхода из системы по управлению базами данных
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
<a class="neonText2">mysql -u root -p mysql < /usr/share/mysql/mysql_test_data_timezone.sql</a> |#|#| Команда для импортирования базы данных "mysql_test_data_timezone.sql" в базу данных MySQL
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
<a class="neonText2">mysql -u root -p</a> |#|#| Команда для входа в систему по управлению базами данных
------------
<a class="neonText2">GRANT SELECT ON mysql.time_zone_name TO cacti@localhost;</a> |#|#| Команда для предоставления доступа пользователю "cacti" до базы данных "mysql.time_zone_name"
------------
<a class="neonText2">flush privileges;</a> |#|#| Команда для сброса привилегий
------------
<a class="neonText2">Exit;</a> |#|#| Команда для выхода из системы по управлению базами данных
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
10) Оптимизация базы данных.
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
<a class="neonText2">nano /etc/my.cnf.d/server.cnf</a> |#|#| Команда для редактирования файла "server.cnf"
------------
В данном файле, в раздел [mysqld] нужно добавить следующие строки:
<a class="neonText2">
collation-server = utf8_general_ci
init-connect='SET NAMES utf8'
character-set-server = utf8
max_heap_table_size = 128M
max_allowed_packet = 16777216
tmp_table_size = 64M
join_buffer_size = 64M
innodb_file_per_table = on
innodb_buffer_pool_size = 512M
innodb_doublewrite = off
innodb_additional_mem_pool_size = 80M
innodb_lock_wait_timeout = 50
innodb_flush_log_at_trx_commit = 2</a>
------------
После чего потребуется перезапуск службы "Mariadb"
------------
<a class="neonText2">systemctl restart mariadb.service</a> |#|#| Команда для перезапуска службы "Mariadb"
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
11) Установка пакета yum-utils.
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
<a class="neonText2">yum install -y yum-utils</a> |#|#| Команда для установки пакета c набором инструментов и программ для управления репозиториями yum, установки пакетов отладки, исходных пакетов, расширенной 
информации из репозиториев и администрирования.
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
12) Обновление пакетов PHP с версии 5 до более свежей.
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Пока вы не обновите пакеты PHP с версии 5 до более свежей, то у вас не установится пакет "Cacti"
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
<a class="neonText2">php --version</a> |#|#| Команда для проверки установленной версии PHP
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
<a class="neonText2">wget -q http://rpms.remirepo.net/enterprise/remi-release-7.rpm</a> |#|#| Команда для скачивания пакета "Remi"
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
<a class="neonText2">wget -q https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm</a> |#|#| Команда для скачивания пакета "Epel"
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
<a class="neonText2">rpm -i remi-release-7.rpm epel-release-latest-7.noarch.rpm</a> |#|#| Команда для установки пакетов "Remi" and "Epel"
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
<a class="neonText2">yum-config-manager --enable remi-php70</a> |#|#| Команда для включения репозитория "remi-php70"
------------
<a class="neonText2">yum-config-manager --enable remi-php71</a> |#|#| Команда для включения репозитория "remi-php71"
------------
<a class="neonText2">yum-config-manager --enable remi-php72</a> |#|#| Команда для включения репозитория "remi-php72"
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
<a class="neonText2">yum install -y php</a> |#|#| Команда для обновления пакета PHP и его зависимостей
------------
<a class="neonText2">yum update -y</a> |#|#| Команда подобна выше предложенной
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
<a class="neonText2">php --version</a> |#|#| Команда для проверки установленной версии PHP
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
13) Установка и настройка Cacti.
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
<a class="neonText2">yum install -y cacti</a> |#|#| Команда для установки пакета "Cacti"
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
<a class="neonText2">cd /usr/share/doc/cacti-1.2.23/</a> |#|#| Команда для перехода в каталог "/usr/share/doc/cacti-1.2.23/"
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
<a class="neonText2">mysql -u root -p  cacti < cacti.sql</a> |#|#| Команда для импорта SQL-файла "cacti.sql" в созданную нами ранее базу данных
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
<a class="neonText2">nano /usr/share/cacti/include/config.php</a> |#|#| Команда для редактирования конфигурационного файла cacti "config.php"
------------
Конфигурацию базы данных нужно привести к следующему виду(лишние строчки в этом столбце нужно удалить):
<a class="neonText2">
$database_type     = 'mysql';
$database_default  = 'cacti';
$database_hostname = 'localhost';
$database_username = 'cacti';
$database_password = 'cacti';
$database_port     = '3306';
$database_ssl      = false;</a>
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
14) Настройка Cron.
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
<a class="neonText2">nano /etc/cron.d/cacti</a> |#|#| Команда для редактирования файла "Cacti" в Cron
------------
Данный конфигурационный файл приведите к следующему виду:
<a class="neonText2">
*/5 * * * *     apache  /usr/bin/php /usr/share/cacti/poller.php > /dev/null 2>&1</a>
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
15) Настройка Apache для Cacti.
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
<a class="neonText2">nano /etc/httpd/conf.d/cacti.conf</a> |#|#| Команда для редактирования файла конфигурации "cacti.conf"
------------
Данный конфигурационный файл приведите к следующему виду:
<a class="neonText2">
Alias /cacti    /usr/share/cacti

&lt;Directory /usr/share/cacti/&gt;
        &lt;IfModule mod_authz_core.c&gt;
                # httpd 2.4
                Require all granted
        &lt;/IfModule&gt;
        &lt;IfModule !mod_authz_core.c&gt;
                # httpd 2.2
                Order deny,allow
                Deny from all
                Allow from all      
        &lt;/IfModule&gt;
&lt;/Directory&gt;</a>
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
<a class="neonText2">nano /etc/php.ini</a> |#|#| Команда для редактирования конфигурационного файла "php.ini"
------------
;date.timezone = |#|#| Данную строку нужно привести к следующему виду:

date.timezone = Asia/Yekaterinburg

--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
После выполнения всех операций, нужно перезагрузить следующие службы:
------------
<a class="neonText2">systemctl restart httpd.service</a> |#|#| Команда для перезагрузки службы "httpd"
------------
<a class="neonText2">systemctl restart mariadb.service</a> |#|#| Команда для перезагрузки службы "mariadb"
------------
<a class="neonText2">systemctl restart snmpd.service</a> |#|#| Команда для перезагрузки службы "snmpd"
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
16) Настройка Firewall.
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
<a class="neonText2">firewall-cmd --permanent --zone=public --add-service=http</a> |#|#| Команда для создания постоянного правила, открытия публичной зоне сервиса "http"
------------
<a class="neonText2">firewall-cmd --reload</a> |#|#| Команда для перезагрузки Firewall
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
17) Настройка Cacti через Web-интерфейс перед использованием.
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Откройте веб-браузер и используйте следующий URL-адрес для доступа к веб-интерфейсу Cacti: http://IP-address_Cacti_Сервера/cacti
------------
Далее нужно:

- Принять лицензионное соглашение и нажать кнопку "Начать";
- Пройдите все страницы проверки, нажав кнопку "Далее";
- Сверьте данные в окне "Тип установки", если все данные были введены верно, то нажмите кнопку "Далее";
- Проверьте все бинарные пути и нажмите кнопку "Далее";
- Проверьте разрешения каталогов и нажмите кнопку "Далее";
- В окне "Настройка шаблона" вы можете выбрать все шаблоны и нажать кнопку "Готово".
------------
После успешной настройки ПО Cacti, у вас появится окно авторизации, в котором вам нужно будет ввести следующие данные:

Username: Admin
Password: Admin
------------
После успешной авторизации вас попросят сменить стандартный пароль на новый. После смены пароля, можете приступать к дальнейшей настройке ПО!
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Как по мне, данное ПО подойдет для мониторинга оборудования в не очень больших организациях. Для более масштабных предприятий рекомендую успользовать что-либо другое.
На этом инструкция закончена! Спасибо за внимание!
</p>
</div>
